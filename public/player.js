var Mist=function(a){if("string"==typeof a&&a in Mist.instances)return Mist.instances[a];var b=this,c=Mist.defaults,d={};b.options=d;b.id=a;b.video=null;b.source=null;b.playing=!1;b.fullscreen=!1;b.events={};b.timers={};b.isready=!1;var e,f,g,h,i,j,k,l,m,n,o,p,q;return b.setup=function(a){for(var e in c)"undefined"!=typeof a&&a[e]?d[e]=a[e]:d[e]=c[e];if(d.video_id&&document.getElementById(d.video_id))b.video=document.getElementById(d.video_id),b.video.mist=!0;else{d.video_id="mist_video_"+b.id,b.video=document.createElement("video"),b.video.id=d.video_id,b.video.mist=!0;var f=d.target;if("string"==typeof d.target&&(f=document.getElementById(d.target)),!f)return void b.log("Target not found");if(f.mist)return b.log("Target already in use"),f.mist;f.innerHTML="",f.appendChild(b.video),f.mist=b}return"string"!=typeof a?b.log("No source specified in options"):d.source=a,b.video.setAttribute("width",d.width),b.video.setAttribute("height",d.height),d.autoplay&&b.video.setAttribute("autoplay","autoplay"),d.loop&&b.video.setAttribute("loop","loop"),d.controls||"native"==d.controls||(b.video.mistControls=!0,b.video.addEventListener("touchstart",function(a){a.preventDefault(),b.video.mistTouchEvent=!0,b.showControls(5e3)},!1)),"native"==d.controls&&b.video.setAttribute("controls","controls"),d.preload&&b.video.setAttribute("preload",d.preload),d.poster&&b.video.setAttribute("poster",d.poster),"undefined"!=typeof d.player_id&&b.video.setAttribute("id",d.player_id),d.playsinline&&b.video.setAttribute("playsinline","playsinline"),b.video.setAttribute("webkit-playsinline","webkit-playsinline"),d.crossorigin&&b.video.setAttribute("crossorigin",d.crossorigin),b.on("canplay",function(){this.isready=!0}),b.load(d.source),b.setupEvents(),d.controls&&"native"!=d.controls&&(b.controls.setup(),b.showControls(5e3)),b.log("Player ready"),Mist.instances[b.id]=b,b},b.on=function(a,c){return"undefined"==typeof b.events[a]&&(b.events[a]=[]),b.events[a].push(c),b},b.one=function(a,c){var d=function(){c.apply(b,arguments),b.off(a,d)};b.on(a,d)},b.off=function(a,c){if("undefined"!=typeof b.events[a]){var d=b.events[a].indexOf(c);-1!=d&&b.events[a].splice(d,1)}},b.trigger=function(a,c){if("undefined"!=typeof b.events[a])for(var d=0;d<b.events[a].length;d++)b.events[a][d].apply(b,[c])},b.load=function(a){if("undefined"!=typeof a&&(d.source=a),"undefined"!=typeof d.source){var c=document.createElement("source");c.setAttribute("src",d.source),b.source=d.source,b.video.appendChild(c),b.one("error",function(a){b.log("Error playing file: "+this.source,a),b.mediaError(a)}),b.one("playing",function(){b.log("Now playing: "+b.source)}),b.video.load()}else b.log("No source to load")},b.destroy=function(){for(var a in b.timers)clearTimeout(b.timers[a]);var c=b.video.parentNode;if(c.mist=null,d.controls)b.controls.destroy();else for(var e;e=b.video.firstChild;)b.video.removeChild(e);c.removeChild(b.video)},b.play=function(){"undefined"!=typeof d.source&&(b.video.mist||b.load(d.source),b.video.play())},b.pause=function(){b.video.pause()},b.stop=function(){b.video.pause(),b.video.currentTime=0},b.fullscreen=function(a){var c=!1;if("undefined"!=typeof a?a&&(c=!0):(c=!b.fullscreen),"undefined"!=typeof document.fullscreenElement||"undefined"!=typeof document.mozFullScreenElement||"undefined"!=typeof document.webkitFullscreenElement)c?(b.video.parentNode.requestFullscreen?b.video.parentNode.requestFullscreen():b.video.parentNode.mozRequestFullScreen?b.video.parentNode.mozRequestFullScreen():b.video.parentNode.webkitRequestFullscreen&&b.video.parentNode.webkitRequestFullscreen(),b.fullscreen=!0):(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),b.fullscreen=!1);else{if(!b.video.webkitEnterFullscreen&&!b.video.webkitExitFullscreen)return void b.log("Fullscreen not supported by this browser");c?b.video.webkitEnterFullscreen():b.video.webkitExitFullscreen(),b.fullscreen=c}b.trigger("fullscreen",b.fullscreen)},b.volume=function(a,c){var d=!1;return"undefined"!=typeof a?(a>1&&(a/=100),b.video.volume=a):"undefined"!=typeof c&&(d=!0),"undefined"!=typeof b.video.muted&&(d?b.video.muted=c:a>0&&(b.video.muted=!1)),{level:b.video.volume,muted:b.video.muted}},b.seek=function(a){b.video.currentTime=a},b.showControls=function(a){if(!b.video.mistTouchEvent&&d.controls&&"native"!=d.controls){b.controls.show();var c=b.video.parentNode;c.className=c.className.replace(" mist-hide-controls","")}},b.hideControls=function(a){if(d.controls&&"native"!=d.controls){b.controls.hide();var c=b.video.parentNode;c.className.indexOf(" mist-hide-controls")<0&&(c.className+=" mist-hide-controls")}},b.mediaError=function(a){var c=a.target.error;switch(c.code){case c.MEDIA_ERR_ABORTED:this.trigger("error","Playback aborted");break;case c.MEDIA_ERR_NETWORK:this.trigger("error","A network error caused the video download to fail part-way.");break;case c.MEDIA_ERR_DECODE:this.trigger("error","Playback aborted due to a corruption problem or because the video used features your browser did not support.");break;case c.MEDIA_ERR_SRC_NOT_SUPPORTED:this.trigger("error","Video not found or not in a supported format.");break;default:this.trigger("error","An unknown error occurred.")}},b.setupEvents=function(){var a,c=["play","pause","volumechange","ended","canplay","playing","timeupdate","progress","error","seeking","seeked"];for(a=0;a<c.length;a++)b.video.addEventListener(c[a],function(a){b.trigger(a.type,a)})}
,b.log=function(){if(d.debug){for(var a="["+b.id+"]",c=0;c<arguments.length;c++)a+=" "+arguments[c];"undefined"!=typeof console.info&&console.info(a)}},b.controls={setup:function(){var a=b.video.parentNode;a.className+=" mist-controls",a.addEventListener("mousemove",function(){b.showControls()}),p=document.createElement("div"),p.className="mist-control-bar",a.appendChild(p),q=document.createElement("div"),q.className="mist-control-bar-background",p.appendChild(q),e=document.createElement("div"),e.className="mist-play-pause",e.addEventListener("click",function(){b.playing?b.pause():b.play()}),p.appendChild(e),n=document.createElement("div"),n.className="mist-load-progress",m=document.createElement("div"),m.className="mist-play-progress",p.appendChild(m),m.appendChild(n);var c,d;m.addEventListener("mousemove",function(a){var e=m.getBoundingClientRect();d=a.clientX-e.left;var f=m.offsetWidth,g=d/f*b.video.duration;c=Math.floor(g/60)+":"+(g%60<10?"0":"")+Math.floor(g%60);var h=document.getElementById("mist-seek-time");h||(h=document.createElement("span"),h.id="mist-seek-time",a.target.appendChild(h)),h.innerHTML=c,h.style.left=d-(h.offsetWidth/2)+"px"}),m.addEventListener("mouseout",function(){var a=document.getElementById("mist-seek-time");a&&a.parentNode.removeChild(a)}),m.addEventListener("click",function(a){var c=m.getBoundingClientRect(),d=a.clientX-c.left,e=m.offsetWidth;b.seek(d/e*b.video.duration)}),f=document.createElement("div"),f.className="mist-volume",p.appendChild(f),g=document.createElement("div"),g.className="mist-volume-knob",f.appendChild(g),f.addEventListener("click",function(a){var c=f.getBoundingClientRect(),d=(a.clientX-c.left)/f.offsetWidth;b.volume(d)}),l=document.createElement("div"),l.className="mist-fullscreen",l.addEventListener("click",function(){b.fullscreen()}),p.appendChild(l),j=document.createElement("div"),j.className="mist-time",k=document.createElement("span"),k.className="mist-time-current",j.appendChild(k),h=document.createElement("span"),h.className="mist-time-separator",h.innerHTML="/",j.appendChild(h),i=document.createElement("span"),i.className="mist-time-duration",j.appendChild(i),p.appendChild(j),b.on("play",function(){b.playing=!0,this.video.parentNode.className=this.video.parentNode.className.replace(" mist-paused","")}),b.on("pause",function(){b.playing=!1,this.video.parentNode.className+=" mist-paused"}),b.on("ended",function(){b.playing=!1,this.video.parentNode.className+=" mist-paused"}),b.on("volumechange",function(){g.style.left=100*this.video.volume-g.offsetWidth/2+"%"}),b.on("timeupdate",function(){var a=b.video.currentTime,c=b.video.duration;n.style.width=a/c*100+"%",k.innerHTML=Math.floor(a/60)+":"+(a%60<10?"0":"")+Math.floor(a%60)}),b.on("progress",function(){var a=b.video.buffered,c=b.video.duration;a.length>0&&(o.style.width=a.end(a.length-1)/c*100+"%")}),b.one("canplay",function(){var a=b.video.duration;i.innerHTML=Math.floor(a/60)+":"+(a%60<10?"0":"")+Math.floor(a%60)}),o=document.createElement("div"),o.className="mist-buffer-progress",n.appendChild(o)},show:function(){p.style.opacity=1,b.video.style.cursor="auto"},hide:function(){p.style.opacity=0,b.video.style.cursor="none"},destroy:function(){var a=b.video.parentNode;a.className=a.className.replace(" mist-controls",""),a.removeChild(p)}}.setup(a)};Mist.instances={},Mist.defaults={width:"100%",height:"100%",debug:!1,autoplay:!1,loop:!1,controls:!0,preload:"auto",poster:"",playsinline:!1,crossorigin:!1},window.mistPlay=function(a,b){var c=new Mist(a);c.setup(b)};
